<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" type="text/css" href="pomodoro.css">
</head>


<body>



<div id="app">
    <div id="header">
        <p>{{ pomodoro | displayPom }}</p>
    </div>
    <div id="main">
        <p id="time">{{ secondsLeft | format }}</p>
    </div>
    <div id="bottom">
        <button @click="stop" id='stop'></button> <!-- &#9726 -->
        <button @click="playPause" id="pp"></button>
        <button @click="next">\>\></button>
    </div>
</div>


</body>



<script>
vm = new Vue({
    el: "#app",
    data: {
        workSeconds: 10, //1500,
        shortSeconds: 5,
        longSeconds: 15,
        fullCycle: 4,
        bkWork: "#ff6b6b",
        bkShort: "#f4a261",
        bkLong: "#2ec4b6",

        secondsLeft: null,
        timer: null,
        pomodoro: 0,
        isPlayOrPause: "play",
        state: 0, // 0: work, 1: short, 2: work, 3: short, 4: work, 5: short, 6: work, 7: long
    },
    created: function() {
        this.secondsLeft = this.workSeconds;
        document.querySelector("body").style.backgroundColor = this.bkWork
    },
    methods: {
        
        playPause() {
            clearTimeout(this.timer);
            var isPaused = this.isPlayOrPause == "pause"
            this.isPlayOrPause = isPaused ? "play" : "pause"
            if (!isPaused) {
                this.setTimer();
            }
        },

        next() {
            clearTimeout(this.timer);
            if ([0, 2, 4].indexOf(this.state) >= 0) {
                this.pomodoro++;
                this.shortPause();

            } else if ([1, 3, 5].indexOf(this.state) >= 0) {
                this.work();
            
            } else if (this.state == 6) {
                this.pomodoro++;
                this.longPause();
            
            } else {
                this.pomodoro = 0;
                this.work()
            }
            this.state = (this.state + 1) % 8
        },

        longPause() {
            // finito il pomodoro-cycle
            document.querySelector("body").style.backgroundColor = this.bkLong
            this.secondsLeft = this.longSeconds
            this.setTimer(true);
        },

        shortPause() {
            document.querySelector("body").style.backgroundColor = this.bkShort
            this.secondsLeft = this.shortSeconds
            this.setTimer();
        },

        work() {
            document.querySelector("body").style.backgroundColor = this.bkWork
            this.secondsLeft = this.workSeconds;
            this.setTimer();
        },

        stop() {
            clearTimeout(this.timer);
            this.secondsLeft = this.workSeconds;
            this.pomodoro = [];
            this.state = 0;
            this.pauseOrResume = "pause";
        },

        setTimer(reset) {
            this.timer = setInterval(() => {
                this.secondsLeft--;
                if (this.secondsLeft === 0) {
                    clearTimeout(this.timer);
                    this.next();
                }
            }, 1000);
        }
    },

    filters: {
        format: function secondsToFormat(seconds) {
                    var minutes = ('0' + Math.floor(seconds / 60)).slice(-2);
                    var seconds = ('0' + (seconds - minutes * 60)).slice(-2);
                    return minutes + ":" + seconds;
                },

        displayPom: function secondsToFormat(pom) {
                        toDisplay = ""
                        toAdd = "üçÖ "
                        i = 0
                        for (i; i < pom; i++) {
                            toDisplay += toAdd
                        }
                        for (i; i< 4; i++) {
                            toDisplay += "X ";
                        }
                        return toDisplay;
                    },
    }
});
</script>

<script>
$(document).ready(function() {
  var btn = $("#pp");
  btn.click(function() {
    btn.toggleClass("paused");
    return false;
  });
});
</script>
