<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Test</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>    
    <script src="https://unpkg.com/vue@next"></script>
    <link rel="stylesheet" type="text/css" href="pomodoro.css">
</head>


<body>



<div id="app">
    <div id="header">
        <div id="phases-container">
            <div id="carousel">
                
                <div class="phase work selected foo"></div>
                <div class="phase short"></div>
                <div class="phase work"></div>
                <div class="phase short"></div>
                <div class="phase work"></div>
                <div class="phase short offscreen"></div>
                <div class="phase work offscreen"></div>
                <div class="phase long offscreen"></div>
                <!--
                <phase-div></phase-div>
                <phase-div></phase-div>
                <phase-div></phase-div>
                <phase-div></phase-div>
                <phase-div></phase-div>
                <phase-div></phase-div>
                <phase-div></phase-div>
                <phase-div></phase-div>-->
            </div>
            <div id="name">work</div>
        </div>
    </div>
    <div id="main">
        <p id="time">{{ timeLeft }}</p>
    </div>
    <div id="bottom">
        <button @click="stop" id='stop'></button> <!-- &#9726 -->
        <button @click="playPause" id="pp"></button>
        <button @click="next">\>\></button>
    </div>
</div>


</body>



<script>
const app = {
    data() {
        return {
            workSeconds: 10, //1500,
            shortSeconds: 5,
            longSeconds: 15,
            fullCycle: 4,
            bkWork: "#ff6b6b",
            bkShort: "#f4a261",
            bkLong: "#2ec4b6",

            secondsLeft: null,
            timer: null,
            pomodoro: 0,
            isPlayOrPause: "play",
            state: 0, // 0: work, 1: short, 2: work, 3: short, 4: work, 5: short, 6: work, 7: long
        }
    },

    computed: {
        timeLeft() {
                    var minutes = ('0' + Math.floor(this.secondsLeft / 60)).slice(-2);
                    var seconds = ('0' + (this.secondsLeft - minutes * 60)).slice(-2);
                    return minutes + ":" + seconds;
                }
    },

    created() {
        this.secondsLeft = this.workSeconds;
        document.querySelector("body").style.backgroundColor = this.bkWork
    },

    methods: {
        
        playPause() {
            clearTimeout(this.timer);
            var isPaused = this.isPlayOrPause == "pause"
            this.isPlayOrPause = isPaused ? "play" : "pause"
            if (!isPaused) {
                this.setTimer();
            }
        },

        next() {
            clearTimeout(this.timer);
            if ([0, 2, 4].indexOf(this.state) >= 0) {
                this.pomodoro++;
                this.shortPause();

            } else if ([1, 3, 5].indexOf(this.state) >= 0) {
                this.work();
            
            } else if (this.state == 6) {
                this.pomodoro++;
                this.longPause();
            
            } else {
                this.pomodoro = 0;
                this.work()
            }
            this.state = (this.state + 1) % 8
            this.stepSlideshow()
        },

        stepSlideshow() {
            $(".phase").first().animate({
                right: "+=59px",
            }, {
                duration: 500,
                queue: false,
                step: function( currentLeft ) {					
                    if (currentLeft > 1) {
                        $(".phase").slice(1).css("right", currentLeft)
                    };
                },
                start: function() {
                    $(".phase").eq(1).addClass("selected")
                    $(".phase.phase:nth-child(6)").fadeIn(500,"easeInCirc", function() { $(".phase:nth-child(6)").removeClass("offscreen")})
                    $(".phase").first().fadeOut(780,"easeOutExpo", function() {
                        $(".phase").first().addClass("offscreen")
                        $(".phase").first().removeClass("selected")
                        $("#carousel").append($(".phase").first())
                        $(".phase").removeAttr("style");
                        }
                    )
                },
            });
        },

        longPause() {
            // finito il pomodoro-cycle
            document.querySelector("body").style.backgroundColor = this.bkLong
            this.secondsLeft = this.longSeconds
            this.setTimer(true);
        },

        shortPause() {
            document.querySelector("body").style.backgroundColor = this.bkShort
            this.secondsLeft = this.shortSeconds
            this.setTimer();
        },

        work() {
            document.querySelector("body").style.backgroundColor = this.bkWork
            this.secondsLeft = this.workSeconds;
            this.setTimer();
        },

        stop() {
            clearTimeout(this.timer);
            this.secondsLeft = this.workSeconds;
            this.pomodoro = [];
            this.state = 0;
            this.pauseOrResume = "pause";
        },

        setTimer(reset) {
            this.timer = setInterval(() => {
                this.secondsLeft--;
                if (this.secondsLeft === 0) {
                    clearTimeout(this.timer);
                    this.next();
                }
            }, 1000);
        }
    },
};

Vue.createApp(app).mount("#app")

</script>

<script>
$(document).ready(function() {
  var btn = $("#pp");
  btn.click(function() {
    btn.toggleClass("paused");
    return false;
  });
});
</script>
